# MP4 è§†é¢‘æ‹¼æ¥å·¥å…· - é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Tauri 2.x + Vue 3 + TypeScript å¼€å‘çš„è·¨å¹³å°æ¡Œé¢åº”ç”¨,ç”¨äºéšæœºé€‰æ‹©è§†é¢‘è¿›è¡Œæ‹¼æ¥ã€‚

**ä»“åº“åœ°å€**: https://github.com/StreadChou/mp4-splicing
**æœ€æ–°ç‰ˆæœ¬**: v0.1.8

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Vue 3 (Composition API)
- **è¯­è¨€**: TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **UI**: åŸç”Ÿ CSS (æ— ç¬¬ä¸‰æ–¹ UI åº“)

### åç«¯
- **æ¡†æ¶**: Tauri 2.x
- **è¯­è¨€**: Rust
- **è§†é¢‘å¤„ç†**: FFmpeg (é€šè¿‡ sidecar æ–¹å¼å†…ç½®)

### ä¾èµ–åŒ…
**å‰ç«¯**:
- `@tauri-apps/api` - Tauri æ ¸å¿ƒ API
- `@tauri-apps/plugin-dialog` - æ–‡ä»¶/ç›®å½•é€‰æ‹©å¯¹è¯æ¡†
- `@tauri-apps/plugin-shell` - Shell å‘½ä»¤æ‰§è¡Œ

**åç«¯**:
- `tauri` - Tauri æ ¸å¿ƒ
- `tauri-plugin-dialog` - å¯¹è¯æ¡†æ’ä»¶
- `tauri-plugin-shell` - Shell æ’ä»¶
- `serde`, `serde_json` - åºåˆ—åŒ–/ååºåˆ—åŒ–
- `rand` - éšæœºæ•°ç”Ÿæˆ
- `walkdir` - ç›®å½•éå†
- `chrono` - æ—¶é—´å¤„ç†
- `image` - å›¾åƒå¤„ç†
- `imageproc` - å›¾åƒå¤„ç†ç®—æ³•
- `rayon` - æ•°æ®å¹¶è¡Œè®¡ç®—åº“

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. è§†é¢‘æ‹¼æ¥
- ä»æŒ‡å®šç›®å½•ä¸­æ‰«ææ‰€æœ‰ `.mp4` æ–‡ä»¶
- éšæœºé€‰æ‹©æŒ‡å®šæ•°é‡çš„è§†é¢‘
- å¦‚æœè¯·æ±‚æ•°é‡å¤§äºå¯ç”¨è§†é¢‘,ä½¿ç”¨å…¨éƒ¨å¹¶æç¤ºç”¨æˆ·
- æ”¯æŒæ·»åŠ å›ºå®šçš„ç»“å°¾è§†é¢‘
- è‡ªåŠ¨æ£€æµ‹è§†é¢‘å…¼å®¹æ€§
- æ”¯æŒå¿«é€Ÿæ¨¡å¼å’Œé‡æ–°ç¼–ç æ¨¡å¼

### 2. è§†é¢‘æ‹†è§£ï¼ˆå•ä¸ªï¼‰
- æå–è§†é¢‘æ‰€æœ‰å¸§çš„ç¼©ç•¥å›¾
- å¯è§†åŒ–å¸§é€‰æ‹©ç•Œé¢ï¼ˆ12åˆ—ç½‘æ ¼å¸ƒå±€ï¼‰
- ç‚¹å‡»é€‰æ‹©èµ·å§‹å’Œç»“æŸå¸§
- æ”¯æŒå¤šä¸ªç‰‡æ®µé€‰æ‹©
- ç²¾ç¡®æŒ‰å¸§åˆ‡å‰²è§†é¢‘
- è‡ªåŠ¨é‡æ–°ç¼–ç ç¡®ä¿è´¨é‡

### 3. æ‰¹é‡æ‹†è§£
- æ‰¹é‡å¤„ç†æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰è§†é¢‘
- æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆä¿å­˜è¿›åº¦åˆ° JSON æ–‡ä»¶ï¼‰
- é¢„åŠ è½½æœºåˆ¶ï¼ˆæå‰åŠ è½½åç»­ 2 ä¸ªä»»åŠ¡ï¼‰
- çµæ´»æ“ä½œï¼šè·³è¿‡ã€ç¨åå¤„ç†ã€åˆ é™¤åŸæ–‡ä»¶
- å®æ—¶è¿›åº¦åé¦ˆ

### 4. è‡ªåŠ¨æ‹†è§£ï¼ˆæ–°åŠŸèƒ½ v0.1.8ï¼‰
- **æ™ºèƒ½åœºæ™¯æ£€æµ‹**ï¼šåŸºäºå¸§ç›¸ä¼¼åº¦è‡ªåŠ¨åˆ‡åˆ†è§†é¢‘
- **ä¸‰ç§ç®—æ³•**ï¼š
  - ç›´æ–¹å›¾ï¼ˆå¿«é€Ÿï¼‰ï¼šä½¿ç”¨å·´æ°è·ç¦»è®¡ç®—ç°åº¦ç›´æ–¹å›¾ç›¸ä¼¼åº¦
  - SSIMï¼ˆå‡†ç¡®ï¼‰ï¼šç»“æ„ç›¸ä¼¼æ€§ç®—æ³•ï¼Œè€ƒè™‘äº®åº¦ã€å¯¹æ¯”åº¦å’Œç»“æ„
  - å¸§å·®å¼‚ï¼ˆç®€å•ï¼‰ï¼šç®€å•çš„åƒç´ å·®å¼‚è®¡ç®—
- **å¯é…ç½®å‚æ•°**ï¼š
  - ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0-100%ï¼‰ï¼šä½äºæ­¤é˜ˆå€¼æ—¶åˆ‡åˆ†åœºæ™¯
  - æœ€å°ç‰‡æ®µç§’æ•°ï¼šç‰‡æ®µé•¿åº¦å¿…é¡»å¤§äºæ­¤å€¼
- **æ— äººå€¼å®ˆæ¨¡å¼**ï¼šå¯ç”¨åè‡ªåŠ¨ä¿ç•™åŸè§†é¢‘å¹¶å¤„ç†ä¸‹ä¸€ä¸ª
- **æ‰¹é‡å¤„ç†**ï¼šè‡ªåŠ¨å¤„ç†æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰è§†é¢‘
- **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒæš‚åœå’Œæ¢å¤
- **å¤šçº¿ç¨‹ä¼˜åŒ–**ï¼ˆv0.1.9ï¼‰ï¼šä½¿ç”¨ rayon å¹¶è¡Œè®¡ç®—å¸§ç›¸ä¼¼åº¦ï¼Œæ€§èƒ½æå‡ 5-8 å€

### 5. å…¼å®¹æ€§æ£€æµ‹
- ä½¿ç”¨ FFprobe æ£€æµ‹è§†é¢‘çš„:
  - ç¼–ç æ ¼å¼ (codec)
  - åˆ†è¾¨ç‡ (width x height)
  - å¸§ç‡ (fps)
- å¦‚æœæ£€æµ‹åˆ°ä¸å…¼å®¹,å¼¹å‡ºå¯¹è¯æ¡†è®©ç”¨æˆ·é€‰æ‹©å¤„ç†æ–¹å¼

### 6. è§†é¢‘æ‹¼æ¥æ¨¡å¼
**å¿«é€Ÿæ¨¡å¼** (å…¼å®¹è§†é¢‘):
- ä½¿ç”¨ `ffmpeg -c copy` ç›´æ¥å¤åˆ¶æµ
- é€Ÿåº¦å¿«,æ— è´¨é‡æŸå¤±

**é‡æ–°ç¼–ç æ¨¡å¼** (ä¸å…¼å®¹è§†é¢‘):
- ä½¿ç”¨ `libx264` ç¼–ç å™¨é‡æ–°ç¼–ç 
- å‚æ•°: `-preset fast -crf 23`
- éŸ³é¢‘: AAC 192k

### 7. è¿›åº¦åé¦ˆ
- å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦
- é€šè¿‡ Tauri äº‹ä»¶ç³»ç»Ÿå‘é€è¿›åº¦æ¶ˆæ¯
- æ”¯æŒå¸§æå–è¿›åº¦ã€ç‰‡æ®µç”Ÿæˆè¿›åº¦ã€ç›¸ä¼¼åº¦åˆ†æè¿›åº¦

---

## é¡¹ç›®ç»“æ„

```
mp4handler/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ build.yml              # GitHub Actions è‡ªåŠ¨æ‰“åŒ…é…ç½®
â”œâ”€â”€ src/                           # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ App.vue                    # ä¸»ç•Œé¢ç»„ä»¶ï¼ˆTab å¯¼èˆªï¼‰
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ VideoConcat.vue        # è§†é¢‘æ‹¼æ¥ç»„ä»¶
â”‚       â”œâ”€â”€ SingleSplit.vue        # å•ä¸ªè§†é¢‘æ‹†è§£ç»„ä»¶
â”‚       â”œâ”€â”€ BatchSplit.vue         # æ‰¹é‡æ‹†è§£ç»„ä»¶
â”‚       â”œâ”€â”€ AutoSplit.vue          # è‡ªåŠ¨æ‹†è§£ç»„ä»¶ï¼ˆæ–°å¢ v0.1.8ï¼‰
â”‚       â””â”€â”€ VideoSplitter.vue      # å¸§é€‰æ‹©å™¨ç»„ä»¶ï¼ˆå…±ç”¨ï¼‰
â”œâ”€â”€ src-tauri/                     # åç«¯æºç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib.rs                 # å…¥å£æ–‡ä»¶,æ³¨å†Œå‘½ä»¤å’Œæ’ä»¶
â”‚   â”‚   â”œâ”€â”€ video_processor.rs    # è§†é¢‘æ‹¼æ¥æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ video_frame_extractor.rs  # è§†é¢‘å¸§æå–å’Œæ‹†è§£é€»è¾‘
â”‚   â”‚   â””â”€â”€ frame_similarity.rs   # å¸§ç›¸ä¼¼åº¦ç®—æ³•ï¼ˆæ–°å¢ v0.1.8ï¼‰
â”‚   â”œâ”€â”€ binaries/                  # FFmpeg äºŒè¿›åˆ¶æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ ffmpeg-aarch64-apple-darwin
â”‚   â”‚   â”œâ”€â”€ ffprobe-aarch64-apple-darwin
â”‚   â”‚   â”œâ”€â”€ ffmpeg-x86_64-pc-windows-msvc.exe
â”‚   â”‚   â””â”€â”€ ffprobe-x86_64-pc-windows-msvc.exe
â”‚   â”œâ”€â”€ capabilities/
â”‚   â”‚   â””â”€â”€ default.json           # æƒé™é…ç½®
â”‚   â”œâ”€â”€ Cargo.toml                 # Rust ä¾èµ–é…ç½®
â”‚   â””â”€â”€ tauri.conf.json            # Tauri é…ç½®
â”œâ”€â”€ package.json                   # å‰ç«¯ä¾èµ–é…ç½®
â””â”€â”€ vite.config.ts                 # Vite é…ç½®
```

---

## å…³é”®æ–‡ä»¶è¯´æ˜

### 1. `src/App.vue`
å‰ç«¯ä¸»ç•Œé¢ï¼Œé‡‡ç”¨å·¦ä¾§ Tab å¯¼èˆªè®¾è®¡ï¼ŒåŒ…å«å››ä¸ªåŠŸèƒ½æ¨¡å—ï¼š
- è§†é¢‘æ‹¼æ¥
- è§†é¢‘æ‹†è§£ï¼ˆå•ä¸ªï¼‰
- æ‰¹é‡æ‹†è§£
- è‡ªåŠ¨æ‹†è§£ï¼ˆæ–°å¢ v0.1.8ï¼‰

### 2. `src/components/AutoSplit.vue` (æ–°å¢ v0.1.8)
è‡ªåŠ¨æ‹†è§£ç•Œé¢ç»„ä»¶ï¼ŒåŒ…å«ï¼š
- è¾“å…¥/è¾“å‡ºæ–‡ä»¶å¤¹é€‰æ‹©
- ç®—æ³•é€‰æ‹©ï¼ˆç›´æ–¹å›¾ã€SSIMã€å¸§å·®å¼‚ï¼‰
- ç›¸ä¼¼åº¦é˜ˆå€¼æ»‘å—ï¼ˆ0-100%ï¼‰
- æœ€å°ç‰‡æ®µç§’æ•°è¾“å…¥
- æ— äººå€¼å®ˆæ¨¡å¼å¤é€‰æ¡†
- æ‰¹é‡ä»»åŠ¡è¿›åº¦æ˜¾ç¤º
- è·³è¿‡ã€ç¨åå¤„ç†ç­‰æ“ä½œæŒ‰é’®

**å…³é”®å‡½æ•°**ï¼š
- `startAutoSplit()` - å¼€å§‹è‡ªåŠ¨æ‹†è§£
- `processCurrentTask()` - å¤„ç†å½“å‰ä»»åŠ¡
- `skipCurrentVideo()` - è·³è¿‡å½“å‰è§†é¢‘
- `postponeCurrentVideo()` - ç¨åå¤„ç†
- `deleteAndNext()` - åˆ é™¤åŸè§†é¢‘å¹¶ç»§ç»­
- `nextWithoutDelete()` - ä¿ç•™åŸè§†é¢‘å¹¶ç»§ç»­

### 3. `src-tauri/src/frame_similarity.rs` (æ–°å¢ v0.1.8)
å¸§ç›¸ä¼¼åº¦ç®—æ³•æ¨¡å—ï¼š

**ä¸»è¦å‡½æ•°**ï¼š
```rust
// è®¡ç®—ä¸¤å¼ å›¾ç‰‡çš„ç›¸ä¼¼åº¦
pub fn calculate_similarity(
    img1_path: &str,
    img2_path: &str,
    algorithm: SimilarityAlgorithm,
) -> Result<f64, String>

// ç›´æ–¹å›¾ç›¸ä¼¼åº¦ç®—æ³•
fn histogram_similarity(img1: &DynamicImage, img2: &DynamicImage) -> Result<f64, String>

// SSIM ç®—æ³•
fn ssim_similarity(img1: &DynamicImage, img2: &DynamicImage) -> Result<f64, String>

// å¸§å·®å¼‚ç®—æ³•
fn frame_diff_similarity(img1: &DynamicImage, img2: &DynamicImage) -> Result<f64, String>
```

### 4. `src-tauri/src/video_frame_extractor.rs`
è§†é¢‘å¸§æå–å’Œæ‹†è§£æ ¸å¿ƒé€»è¾‘ï¼š

**ä¸»è¦å‡½æ•°**ï¼š
```rust
// è·å–è§†é¢‘å…ƒæ•°æ®
#[tauri::command]
pub async fn get_video_metadata(app: AppHandle, video_path: String) -> Result<VideoMetadata, String>

// æå–æ‰€æœ‰å¸§
#[tauri::command]
pub async fn extract_all_frames(app: AppHandle, video_path: String) -> Result<Vec<FrameInfo>, String>

// ç”Ÿæˆè§†é¢‘ç‰‡æ®µ
#[tauri::command]
pub async fn generate_video_segments(app: AppHandle, video_path: String, segments: Vec<SegmentRange>, output_dir: String) -> Result<String, String>

// è‡ªåŠ¨æ‹†è§£è§†é¢‘ï¼ˆæ–°å¢ v0.1.8ï¼‰
#[tauri::command]
pub async fn auto_split_video(
    app: AppHandle,
    video_path: String,
    output_dir: String,
    algorithm: String,
    threshold: f64,
    min_duration: f64,
) -> Result<String, String>

// åˆ—å‡º MP4 æ–‡ä»¶
#[tauri::command]
pub fn list_mp4_files(dir_path: String) -> Result<Vec<String>, String>

// æ‰¹é‡è¿›åº¦ç®¡ç†
#[tauri::command]
pub fn load_batch_progress(progress_path: String) -> Result<Option<BatchProgress>, String>

#[tauri::command]
pub fn save_batch_progress(progress_path: String, progress: BatchProgress) -> Result<(), String>
```

### 5. `src-tauri/src/video_processor.rs`
è§†é¢‘æ‹¼æ¥æ ¸å¿ƒé€»è¾‘ï¼š

**ä¸»è¦å‡½æ•°**ï¼š
```rust
// éšæœºé€‰æ‹©è§†é¢‘
fn get_random_videos(dir: &str, count: usize) -> Result<(Vec<PathBuf>, usize), String>

// è·å–è§†é¢‘ä¿¡æ¯
async fn get_video_info(app: &AppHandle, video_path: &Path) -> Result<VideoInfo, String>

// æ£€æµ‹å…¼å®¹æ€§
async fn check_video_compatibility(app: &AppHandle, videos: &[PathBuf]) -> Result<CompatibilityResult, String>

// å¿«é€Ÿæ‹¼æ¥å‘½ä»¤
#[tauri::command]
pub async fn concat_videos(app: AppHandle, input_dir: String, ending_video: Option<String>, random_count: usize, output_dir: String) -> Result<String, String>

// é‡æ–°ç¼–ç æ‹¼æ¥å‘½ä»¤
#[tauri::command]
pub async fn concat_videos_with_reencode(app: AppHandle, input_dir: String, ending_video: Option<String>, random_count: usize, output_dir: String) -> Result<String, String>
```

### 6. `src-tauri/src/lib.rs`
Tauri åº”ç”¨å…¥å£ï¼š
```rust
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_opener::init())
        .plugin(tauri_plugin_dialog::init())
        .plugin(tauri_plugin_shell::init())
        .invoke_handler(tauri::generate_handler![
            greet,
            video_processor::concat_videos,
            video_processor::concat_videos_with_reencode,
            video_frame_extractor::get_video_metadata,
            video_frame_extractor::extract_all_frames,
            video_frame_extractor::generate_video_segments,
            video_frame_extractor::list_mp4_files,
            video_frame_extractor::load_batch_progress,
            video_frame_extractor::save_batch_progress,
            video_frame_extractor::delete_video_file,
            video_frame_extractor::auto_split_video,  // æ–°å¢ v0.1.8
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```
æƒé™é…ç½®:
```json
{
  "permissions": [
    "core:default",
    "opener:default",
    "dialog:default",
    "shell:default",
    "shell:allow-execute",
    "shell:allow-spawn"
  ]
}
```

### 5. `.github/workflows/build.yml`
GitHub Actions è‡ªåŠ¨æ‰“åŒ…é…ç½®:
- åœ¨ macOS å’Œ Windows ç¯å¢ƒä¸­è‡ªåŠ¨æ„å»º
- ç”Ÿæˆä¾¿æºç‰ˆå’Œå®‰è£…ç‰ˆ
- ä¸Šä¼ ä¸º Artifacts

---

## å¼€å‘å‘½ä»¤

### å®‰è£…ä¾èµ–
```bash
yarn install
```

### å¼€å‘æ¨¡å¼
```bash
yarn tauri dev
```

### æ‰“åŒ…
```bash
yarn tauri build
```

### å‘å¸ƒæ–°ç‰ˆæœ¬
```bash
git tag v0.1.x
git push origin v0.1.x
# ç­‰å¾… GitHub Actions æ„å»ºå®Œæˆ
gh run download <run-id>
gh release create v0.1.x --title "ç‰ˆæœ¬æ ‡é¢˜" --notes "æ›´æ–°è¯´æ˜" macos-build/*.zip windows-build/*.zip windows-build/bundle/nsis/*.exe
```

---

## è¾“å‡ºæ–‡ä»¶

### macOS
- **å¼€å‘**: `src-tauri/target/debug/mp4handler`
- **å‘å¸ƒ**: `src-tauri/target/release/bundle/macos/mp4handler.app`
- **ä¾¿æºç‰ˆ**: `mp4handler-macos-portable.zip`

### Windows
- **å¼€å‘**: `src-tauri/target/debug/mp4handler.exe`
- **å‘å¸ƒ**: `src-tauri/target/release/mp4handler.exe`
- **å®‰è£…ç¨‹åº**: `src-tauri/target/release/bundle/nsis/mp4handler_0.1.8_x64-setup.exe`
- ~~**ä¾¿æºç‰ˆ**: å·²ç§»é™¤ï¼ˆv0.1.8ï¼‰~~

---

## å·¥ä½œæµç¨‹

### è§†é¢‘æ‹¼æ¥æµç¨‹
1. é€‰æ‹©åŒ…å« MP4 æ–‡ä»¶çš„è¾“å…¥ç›®å½•
2. (å¯é€‰) é€‰æ‹©ç»“å°¾è§†é¢‘
3. è®¾ç½®éšæœºé€‰æ‹©çš„è§†é¢‘æ•°é‡
4. é€‰æ‹©è¾“å‡ºç›®å½•
5. ç‚¹å‡»"å¼€å§‹æ‹¼æ¥"
6. å¦‚æœè§†é¢‘ä¸å…¼å®¹,é€‰æ‹©å¤„ç†æ–¹å¼:
   - ç›´æ¥æ‹¼æ¥(å¿«é€Ÿä½†å¯èƒ½å¤±è´¥)
   - é‡æ–°ç¼–ç æ‹¼æ¥(æ…¢ä½†ä¿è¯æˆåŠŸ)
7. ç­‰å¾…å¤„ç†å®Œæˆ
8. åœ¨è¾“å‡ºç›®å½•æŸ¥çœ‹ç”Ÿæˆçš„è§†é¢‘

### å•ä¸ªè§†é¢‘æ‹†è§£æµç¨‹
1. é€‰æ‹©è¦æ‹†è§£çš„è§†é¢‘æ–‡ä»¶
2. ç­‰å¾…æå–æ‰€æœ‰å¸§çš„ç¼©ç•¥å›¾
3. åœ¨ç½‘æ ¼ä¸­ç‚¹å‡»é€‰æ‹©èµ·å§‹å¸§å’Œç»“æŸå¸§
4. å¯ä»¥é€‰æ‹©å¤šä¸ªç‰‡æ®µ
5. ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"
6. ç­‰å¾…ç‰‡æ®µç”Ÿæˆå®Œæˆ

### æ‰¹é‡æ‹†è§£æµç¨‹
1. é€‰æ‹©åŒ…å«è§†é¢‘çš„è¾“å…¥æ–‡ä»¶å¤¹
2. é€‰æ‹©è¾“å‡ºæ–‡ä»¶å¤¹
3. ç‚¹å‡»"å¼€å§‹è¯»å–"
4. ç³»ç»ŸåŠ è½½ç¬¬ä¸€ä¸ªè§†é¢‘çš„å¸§
5. æ‰‹åŠ¨é€‰æ‹©è¦æ‹†è§£çš„ç‰‡æ®µ
6. ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"
7. é€‰æ‹©åˆ é™¤æˆ–ä¿ç•™åŸè§†é¢‘
8. è‡ªåŠ¨åŠ è½½ä¸‹ä¸€ä¸ªè§†é¢‘
9. é‡å¤æ­¥éª¤ 5-8 ç›´åˆ°æ‰€æœ‰è§†é¢‘å¤„ç†å®Œæˆ

### è‡ªåŠ¨æ‹†è§£æµç¨‹ï¼ˆæ–°å¢ v0.1.8ï¼‰
1. é€‰æ‹©åŒ…å«è§†é¢‘çš„è¾“å…¥æ–‡ä»¶å¤¹
2. é€‰æ‹©è¾“å‡ºæ–‡ä»¶å¤¹
3. é…ç½®å‚æ•°ï¼š
   - é€‰æ‹©ç›¸ä¼¼åº¦ç®—æ³•ï¼ˆç›´æ–¹å›¾/SSIM/å¸§å·®å¼‚ï¼‰
   - è®¾ç½®ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆé»˜è®¤ 70%ï¼‰
   - è®¾ç½®æœ€å°ç‰‡æ®µç§’æ•°ï¼ˆé»˜è®¤ 2 ç§’ï¼‰
   - (å¯é€‰) å¯ç”¨æ— äººå€¼å®ˆæ¨¡å¼
4. ç‚¹å‡»"å¼€å§‹è‡ªåŠ¨æ‹†è§£"
5. ç³»ç»Ÿè‡ªåŠ¨å¤„ç†æ¯ä¸ªè§†é¢‘ï¼š
   - æå–æ‰€æœ‰å¸§
   - é€å¸§å¯¹æ¯”ç›¸ä¼¼åº¦
   - æ£€æµ‹åœºæ™¯åˆ‡æ¢ç‚¹
   - è‡ªåŠ¨ç”Ÿæˆç‰‡æ®µ
6. å¦‚æœå¯ç”¨æ— äººå€¼å®ˆæ¨¡å¼ï¼š
   - è‡ªåŠ¨ä¿ç•™åŸè§†é¢‘å¹¶å¤„ç†ä¸‹ä¸€ä¸ª
7. å¦‚æœæœªå¯ç”¨æ— äººå€¼å®ˆæ¨¡å¼ï¼š
   - é€‰æ‹©åˆ é™¤æˆ–ä¿ç•™åŸè§†é¢‘
   - æ‰‹åŠ¨ç‚¹å‡»ç»§ç»­ä¸‹ä¸€ä¸ª
8. æ‰€æœ‰è§†é¢‘å¤„ç†å®Œæˆåæ˜¾ç¤ºæç¤º

### æŠ€æœ¯æµç¨‹
1. **å‰ç«¯**: ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æ‹¼æ¥"
2. **å‰ç«¯**: è°ƒç”¨ `invoke('concat_videos', {...})`
3. **åç«¯**: æ¥æ”¶å‚æ•°,éªŒè¯è¾“å…¥
4. **åç«¯**: æ‰«æç›®å½•,éšæœºé€‰æ‹©è§†é¢‘
5. **åç«¯**: ä½¿ç”¨ FFprobe æ£€æµ‹è§†é¢‘å…¼å®¹æ€§
6. **åç«¯**: å¦‚æœä¸å…¼å®¹,è¿”å›é”™è¯¯ç  `INCOMPATIBLE_VIDEOS:`
7. **å‰ç«¯**: æ˜¾ç¤ºå…¼å®¹æ€§å¯¹è¯æ¡†
8. **å‰ç«¯**: æ ¹æ®ç”¨æˆ·é€‰æ‹©è°ƒç”¨å¯¹åº”å‘½ä»¤
9. **åç«¯**: åˆ›å»ºä¸´æ—¶ concat æ–‡ä»¶
10. **åç«¯**: è°ƒç”¨ FFmpeg æ‹¼æ¥è§†é¢‘
11. **åç«¯**: å‘é€è¿›åº¦äº‹ä»¶åˆ°å‰ç«¯
12. **åç«¯**: æ¸…ç†ä¸´æ—¶æ–‡ä»¶
13. **åç«¯**: è¿”å›æˆåŠŸæ¶ˆæ¯
14. **å‰ç«¯**: æ˜¾ç¤ºå®Œæˆæç¤º

---

## è¿›åº¦äº‹ä»¶

åç«¯é€šè¿‡ Tauri äº‹ä»¶ç³»ç»Ÿå‘é€è¿›åº¦æ›´æ–°ï¼š

### è§†é¢‘æ‹¼æ¥è¿›åº¦
- "æ­£åœ¨æ‰«æè§†é¢‘æ–‡ä»¶..."
- "å·²é€‰æ‹© X ä¸ªè§†é¢‘"
- "è¯·æ±‚ X ä¸ªè§†é¢‘,ä½†åªæ‰¾åˆ° Y ä¸ª,å°†ä½¿ç”¨å…¨éƒ¨ Y ä¸ªè§†é¢‘"
- "å·²æ·»åŠ ç»“å°¾è§†é¢‘"
- "æ­£åœ¨æ£€æµ‹è§†é¢‘å…¼å®¹æ€§..."
- "æ­£åœ¨æ‹¼æ¥è§†é¢‘(å¿«é€Ÿæ¨¡å¼)..."
- "æ­£åœ¨æ‹¼æ¥è§†é¢‘(é‡æ–°ç¼–ç æ¨¡å¼,è¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´)..."
- "å®Œæˆ!"

### å¸§æå–è¿›åº¦ (`frame_progress`)
- `{ message: "æ­£åœ¨æå–è§†é¢‘å¸§...", percent: 0 }`
- `{ message: "å·²æå– X/Y å¸§", percent: 50 }`

### ç‰‡æ®µç”Ÿæˆè¿›åº¦ (`segment_progress`)
- `{ current: 1, total: 5, segmentName: "video_1.mp4", percent: 20 }`

### è‡ªåŠ¨æ‹†è§£è¿›åº¦ (`auto_split_progress`)ï¼ˆæ–°å¢ v0.1.8ï¼‰
- `{ message: "æ­£åœ¨æå–è§†é¢‘å¸§...", percent: 0 }`
- `{ message: "æ­£åœ¨åˆ†æå¸§ç›¸ä¼¼åº¦...", percent: 10 }`
- `{ message: "å·²åˆ†æ X/Y å¸§", percent: 50 }`
- `{ message: "æ­£åœ¨ç”Ÿæˆè§†é¢‘ç‰‡æ®µ...", percent: 70 }`
- `{ message: "å®Œæˆ", percent: 100 }`

å‰ç«¯é€šè¿‡ `listen("event_name", callback)` ç›‘å¬å¹¶æ˜¾ç¤ºã€‚

---

## é”™è¯¯å¤„ç†

### å‰ç«¯éªŒè¯
- è¾“å…¥ç›®å½•ä¸èƒ½ä¸ºç©º
- è¾“å‡ºç›®å½•ä¸èƒ½ä¸ºç©º
- éšæœºæ•°é‡å¿…é¡» > 0

### åç«¯é”™è¯¯
- ç›®å½•ä¸å­˜åœ¨æˆ–æ— æƒé™
- æœªæ‰¾åˆ° MP4 æ–‡ä»¶
- ç»“å°¾è§†é¢‘ä¸å­˜åœ¨
- FFmpeg/FFprobe æ‰§è¡Œå¤±è´¥
- è§†é¢‘ä¸å…¼å®¹ (ç‰¹æ®Šé”™è¯¯ç : `INCOMPATIBLE_VIDEOS:`)

æ‰€æœ‰é”™è¯¯éƒ½è¿”å›ä¸­æ–‡æè¿°ã€‚

---

## FFmpeg ä½¿ç”¨

### å¿«é€Ÿæ‹¼æ¥ (å…¼å®¹è§†é¢‘)
```bash
ffmpeg -f concat -safe 0 -i concat_list.txt -c copy output.mp4
```

### é‡æ–°ç¼–ç æ‹¼æ¥ (ä¸å…¼å®¹è§†é¢‘)
```bash
ffmpeg -f concat -safe 0 -i concat_list.txt \
  -c:v libx264 -preset fast -crf 23 \
  -c:a aac -b:a 192k \
  output.mp4
```

### æ£€æµ‹è§†é¢‘ä¿¡æ¯
```bash
ffprobe -v error -select_streams v:0 \
  -show_entries stream=codec_name,width,height,r_frame_rate \
  -of json video.mp4
```

### æå–æ‰€æœ‰å¸§
```bash
ffmpeg -i video.mp4 \
  -vf "fps=30,scale=320:-1" \
  -vsync 0 -q:v 3 \
  frame_%05d.jpg
```

### ç²¾ç¡®åˆ‡å‰²è§†é¢‘ç‰‡æ®µ
```bash
ffmpeg -i video.mp4 \
  -ss 10.5 -t 5.0 \
  -c:v libx264 -preset fast -crf 18 \
  -r 30 -c:a aac -b:a 192k \
  output.mp4
```

---

## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 1. è§†é¢‘æ ¼å¼
- ä»…æ”¯æŒ `.mp4` æ ¼å¼
- å…¶ä»–æ ¼å¼éœ€è¦å…ˆè½¬æ¢

### 2. æ–‡ä»¶å¤§å°
- åº”ç”¨ä½“ç§¯è¾ƒå¤§ (çº¦ 160-200 MB)
- å› ä¸ºå†…ç½®äº†å®Œæ•´çš„ FFmpeg

### 3. æ€§èƒ½
- é‡æ–°ç¼–ç æ¨¡å¼è¾ƒæ…¢,å–å†³äºè§†é¢‘å¤§å°å’Œæ•°é‡
- å¿«é€Ÿæ¨¡å¼å‡ ä¹ç¬é—´å®Œæˆ
- è‡ªåŠ¨æ‹†è§£å·²ä¼˜åŒ–ä¸ºå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—ï¼ˆv0.1.9ï¼‰ï¼š
  - 10 åˆ†é’Ÿ 30fps è§†é¢‘ï¼ˆ18,000 å¸§ï¼‰å¤„ç†æ—¶é—´ï¼š
    - ç›´æ–¹å›¾ç®—æ³•ï¼šçº¦ 10-15 ç§’
    - å¸§å·®å¼‚ç®—æ³•ï¼šçº¦ 15-25 ç§’
    - SSIM ç®—æ³•ï¼šçº¦ 30-45 ç§’
  - å¤šæ ¸ CPU åˆ©ç”¨ç‡å¯è¾¾ 80-90%

### 4. æ‰“åŒ…
- Windows ä¾¿æºç‰ˆå·²ç§»é™¤ï¼ˆv0.1.8ï¼‰
- ä»…æä¾› Windows å®‰è£…åŒ…å’Œ macOS ä¾¿æºç‰ˆ

---

## åç»­å¼€å‘å»ºè®®

### åŠŸèƒ½å¢å¼º
1. ~~**è§†é¢‘é¢„è§ˆ**: æ˜¾ç¤ºé€‰ä¸­è§†é¢‘çš„ç¼©ç•¥å›¾~~ âœ… å·²å®ç°ï¼ˆv0.1.4ï¼‰
2. **è¿›åº¦æ¡**: æ˜¾ç¤ºç™¾åˆ†æ¯”è¿›åº¦ âœ… å·²å®ç°ï¼ˆv0.1.4ï¼‰
3. **å–æ¶ˆåŠŸèƒ½**: å…è®¸ä¸­é€”å–æ¶ˆå¤„ç†
4. ~~**æ‰¹é‡å¤„ç†**: æ”¯æŒç”Ÿæˆå¤šä¸ªæ‹¼æ¥è§†é¢‘~~ âœ… å·²å®ç°ï¼ˆv0.1.4ï¼‰
5. **è‡ªå®šä¹‰é¡ºåº**: å…è®¸æ‰‹åŠ¨æ’åºè§†é¢‘
6. **ä¿å­˜é…ç½®**: è®°ä½ä¸Šæ¬¡ä½¿ç”¨çš„ç›®å½•å’Œè®¾ç½®
7. **æ›´å¤šæ ¼å¼**: æ”¯æŒ `.avi`, `.mov`, `.mkv` ç­‰æ ¼å¼
8. **è½¬åœºæ•ˆæœ**: æ·»åŠ è§†é¢‘ä¹‹é—´çš„è½¬åœºåŠ¨ç”»
9. **éŸ³é¢‘å¤„ç†**: æ”¯æŒæ·»åŠ èƒŒæ™¯éŸ³ä¹ã€è°ƒæ•´éŸ³é‡
10. **å­—å¹•æ”¯æŒ**: æ”¯æŒæ·»åŠ å­—å¹•æ–‡ä»¶
11. ~~**æ™ºèƒ½åœºæ™¯æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«åœºæ™¯åˆ‡æ¢ç‚¹~~ âœ… å·²å®ç°ï¼ˆv0.1.8ï¼‰
12. **æ›´å¤šç›¸ä¼¼åº¦ç®—æ³•**: PSNRã€è¾¹ç¼˜æ£€æµ‹ç­‰
13. **GPU åŠ é€Ÿ**: ä½¿ç”¨ GPU åŠ é€Ÿå›¾åƒå¤„ç†

### æŠ€æœ¯ä¼˜åŒ–
1. **é”™è¯¯æ¢å¤**: å•ä¸ªè§†é¢‘å¤±è´¥æ—¶ç»§ç»­å¤„ç†å…¶ä»–è§†é¢‘
2. **æ—¥å¿—ç³»ç»Ÿ**: è®°å½•è¯¦ç»†çš„æ“ä½œæ—¥å¿—
3. **å¤šè¯­è¨€**: æ”¯æŒè‹±æ–‡ç­‰å…¶ä»–è¯­è¨€
4. **ä¸»é¢˜åˆ‡æ¢**: æ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜
5. ~~**æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†~~ âœ… å·²å®ç°ï¼ˆv0.1.9ï¼‰
6. **å†…å­˜ä¼˜åŒ–**: å¤„ç†å¤§æ–‡ä»¶æ—¶çš„å†…å­˜ç®¡ç†

### ç”¨æˆ·ä½“éªŒ
1. **æ‹–æ‹½æ”¯æŒ**: æ”¯æŒæ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹
2. **å¿«æ·é”®**: æ·»åŠ é”®ç›˜å¿«æ·é”®
3. **å†å²è®°å½•**: è®°å½•æœ€è¿‘çš„æ“ä½œ
4. **é¢„è®¾æ¨¡æ¿**: æä¾›å¸¸ç”¨é…ç½®æ¨¡æ¿
5. **å¸®åŠ©æ–‡æ¡£**: å†…ç½®ä½¿ç”¨è¯´æ˜

---

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ Rust æ—¥å¿—
```bash
RUST_LOG=debug yarn tauri dev
```

### æŸ¥çœ‹å‰ç«¯æ§åˆ¶å°
åœ¨å¼€å‘æ¨¡å¼ä¸‹,æŒ‰ `Cmd+Option+I` (macOS) æˆ– `F12` (Windows) æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚

### æµ‹è¯• FFmpeg
```bash
# macOS
./src-tauri/binaries/ffmpeg-aarch64-apple-darwin -version

# Windows
./src-tauri/binaries/ffmpeg-x86_64-pc-windows-msvc.exe -version
```

### æ¸…ç†æ„å»ºç¼“å­˜
```bash
cd src-tauri
cargo clean
cd ..
rm -rf node_modules dist
yarn install
```

---

## ç›¸å…³èµ„æº

- **Tauri æ–‡æ¡£**: https://tauri.app/
- **Vue 3 æ–‡æ¡£**: https://vuejs.org/
- **FFmpeg æ–‡æ¡£**: https://ffmpeg.org/documentation.html
- **Rust æ–‡æ¡£**: https://doc.rust-lang.org/

---

## è®¸å¯è¯

è¯·ç¡®ä¿éµå®ˆ FFmpeg çš„ LGPL/GPL è®¸å¯è¯è¦æ±‚ã€‚

---

**æœ€åæ›´æ–°**: 2026-01-29
**ç‰ˆæœ¬**: v0.1.9

## æ›´æ–°æ—¥å¿—

### v0.1.9 (2026-01-29)
- âš¡ è‡ªåŠ¨æ‹†è§£å¤šçº¿ç¨‹ä¼˜åŒ–
  - ä½¿ç”¨ rayon å¹¶è¡Œè®¡ç®—å¸§ç›¸ä¼¼åº¦
  - æ€§èƒ½æå‡ 5-8 å€ï¼ˆ8 æ ¸ CPUï¼‰
  - CPU åˆ©ç”¨ç‡ä» 12.5% æå‡è‡³ 80-90%
  - 10 åˆ†é’Ÿè§†é¢‘å¤„ç†æ—¶é—´ä» 10+ åˆ†é’Ÿé™è‡³ 2-3 åˆ†é’Ÿ
- ğŸ”§ ä¼˜åŒ–è¿›åº¦æ›´æ–°é¢‘ç‡ï¼ˆä»æ¯ 50 å¸§æ”¹ä¸ºæ¯ 100 å¸§ï¼‰
- ğŸ›¡ï¸ å¢å¼ºé”™è¯¯å¤„ç†ï¼ˆå¹¶è¡Œè®¡ç®—ä¸­çš„é”™è¯¯ä¸ä¼šä¸­æ–­æ•´ä½“æµç¨‹ï¼‰

### v0.1.8 (2026-01-29)
- âœ¨ æ–°å¢è‡ªåŠ¨æ‹†è§£åŠŸèƒ½
  - ä¸‰ç§ç›¸ä¼¼åº¦ç®—æ³•ï¼šç›´æ–¹å›¾ã€SSIMã€å¸§å·®å¼‚
  - å¯é…ç½®ç›¸ä¼¼åº¦é˜ˆå€¼å’Œæœ€å°ç‰‡æ®µç§’æ•°
  - æ— äººå€¼å®ˆæ¨¡å¼ï¼šè‡ªåŠ¨ä¿ç•™åŸè§†é¢‘å¹¶å¤„ç†ä¸‹ä¸€ä¸ª
  - æ‰¹é‡å¤„ç†æ”¯æŒ
  - æ–­ç‚¹ç»­ä¼ åŠŸèƒ½
- ğŸ”§ ç§»é™¤ Windows ä¾¿æºç‰ˆæ‰“åŒ…
- ğŸ“ æ›´æ–°é¡¹ç›®æ–‡æ¡£

### v0.1.4 (2026-01-28)
- æ–°å¢äº¤äº’å¼è§†é¢‘æ‹†è§£åŠŸèƒ½
- æ–°å¢æ‰¹é‡è§†é¢‘æ‹†è§£åŠŸèƒ½
- ä¼˜åŒ– UI å¸ƒå±€ï¼Œé‡‡ç”¨å·¦ä¾§å¯¼èˆªæ è®¾è®¡
- é‡æ„ä»£ç ä¸ºç»„ä»¶åŒ–æ¶æ„
- ä¼˜åŒ–é¢œè‰²å¯¹æ¯”åº¦ï¼Œæå‡å¯è¯»æ€§
- æ·»åŠ å¸§é€‰æ‹©åè‡ªåŠ¨æ»šåŠ¨åˆ°é¡¶éƒ¨åŠŸèƒ½
- å¢å¼ºé€‰ä¸­å¸§çš„è§†è§‰åé¦ˆï¼ˆ4px è¾¹æ¡†ï¼‰
